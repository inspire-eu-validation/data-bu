# Constraints

**Purpose**: Verify that the features provided in the dataset adhere to the constraints specified in the INSPIRE application schema.

**Prerequisites**

**Test method**

The following checks are performed for every feature in the dataset.

* **percentageSum**: Check that the total of all percentages ([percentage](#percentage) element of the CurrentUse data type) are less or equal to 100. (OCL: "inv: self.percentage.sum()<=100")
* **atLeastOneEvent**: Check that at least one of the attributes [beginning](#beginning), [end](#end) or [anyPoint](#anyPoint) is supplied. (OCL: "inv: dateOfEvent->notEmpty()").
* **beginning is before anyPoint is before end**: Check that, if more dates are provided, the beginning attribute shall not be after the anyPoint attribute and the end attribute, and the anyPoint attribute shall not be after the end attribute. (OCL: "inv: beginning <= anyPoint and anyPoint <= end and beginning <= end)").
* **valueUoMIsMetre**: Check that the [value](#value) of HeightAboveGround is in meters. (OCL: "inv: self.value.uom.uomSymbol='m'")
* **geometryIsPointOrSurfaceOrMultiSurface**: Check that the [geometry](#geometry) is of type GM_Point or GM_Surface or GM_MultiSurface.
* **horizontalGeometryEstimatedAccuracyUoMIsMetre**: Check that the value of [horizontalGeometryEstimatedAccuracy](#hGEA) is given in meters. (OCL: "inv: self.horizontalGeometryEstimatedAccuracy.uom.uomSymbol='m'")
* **verticalGeometryEstimatedAccuracyUoMIsMetre**: Check that the value of [verticalGeometryEstimatedAccuracy](#vGEA) is given in meters. (OCL: "inv: self.verticalGeometryEstimatedAccuracy.uom.uomSymbol='m')")
* **referenceGeometry**: Check that for exactly one item of BuildingGeometry, the value of the attribute [referenceGeometry](#referenceGeometry) is “true”.


**Reference(s)**: 

* [TG DS Template](./README.md#ref_TG_DS_tmpl) IR requirement Article 4 (2)
* [TG DS-BU](./README.md#ref_TG_DS_BU) 5.3.2.2.5.; 5.3.2.2.1.; 5.3.2.2.2.; 5.3.2.2.4.

**Test type**: Automated

**Notes** 

Verify that the OCL constraints that are specified in the UML model of the application schema are met, i.e. validate features against the constraints. For unmet constraints report [constraintViolation](#constraintViolation).

## Messages

Identifier  |  Message text (parameters start with '$')
---------------------------------------------------------- | -------------------------------------------------------------------------
constraintViolation <a name="constraintViolation"/>  |  XML document '$filename', $featureType '$gmlid': The constraint '$constraint' is violated.

## Contextual XPath references

The namespace prefixes used as described in [README](./README.md#namespaces).

Abbreviation                                               |  XPath expression                     |Multiplicity       |Voidable
---------------------------------------------------------- | ------------------------------------- | ------------------|----------
percentage <a name="percentage"></a> | //schema-element(bu-core2d:Building)/bu-base:currentUse/bu-base:CurrentUse/bu-base:percentage <br> //schema-element(bu-core2d:BuildingPart)/bu-base:currentUse/bu-base:CurrentUse/bu-base:percentage <br> //schema-element(bu-core3d:Building)/bu-base:currentUse/bu-base:CurrentUse/bu-base:percentage <br> //schema-element(bu-core3d:BuildingPart)/bu-base:currentUse/bu-base:CurrentUse/bu-base:percentage| 1 (The parent is optional) | Yes
beginning <a name="beginning"></a> | //schema-element(bu-core2d:Building)/bu-base:dateOfConstruction/bu-base:DateOfEvent/bu-base:beginning <br>//schema-element(bu-core2d:Building)/bu-base:dateOfDemolition/bu-base:DateOfEvent/bu-base:beginning <br> //schema-element(bu-core2d:Building)/bu-base:dateOfRenovation/bu-base:DateOfEvent/bu-base:beginning <br>//schema-element(bu-core2d:BuildingPart)/bu-base:dateOfConstruction/bu-base:DateOfEvent/bu-base:beginning <br>//schema-element(bu-core2d:BuildingPart)/bu-base:dateOfDemolition/bu-base:DateOfEvent/bu-base:beginning <br> //schema-element(bu-core2d:BuildingPart)/bu-base:dateOfRenovation/bu-base:DateOfEvent/bu-base:beginning <br>//schema-element(bu-core3d:Building)/bu-base:dateOfConstruction/bu-base:DateOfEvent/bu-base:beginning <br>//schema-element(bu-core3d:Building)/bu-base:dateOfDemolition/bu-base:DateOfEvent/bu-base:beginning <br>//schema-element(bu-core3d:Building)/bu-base:dateOfRenovation/bu-base:DateOfEvent/bu-base:beginning <br> //schema-element(bu-core3d:BuildingPart)/bu-base:dateOfConstruction/bu-base:DateOfEvent/bu-base:beginning <br>//schema-element(bu-core3d:BuildingPart)/bu-base:dateOfDemolition/bu-base:DateOfEvent/bu-base:beginning <br>//schema-element(bu-core3d:BuildingPart)/bu-base:dateOfRenovation/bu-base:DateOfEvent/bu-base:beginning | 0..1 | Yes
end <a name="end"></a> | //schema-element(bu-core2d:Building)/bu-base:dateOfConstruction/bu-base:DateOfEvent/bu-base:end <br>//schema-element(bu-core2d:Building)/bu-base:dateOfDemolition/bu-base:DateOfEvent/bu-base:end <br> //schema-element(bu-core2d:Building)/bu-base:dateOfRenovation/bu-base:DateOfEvent/bu-base:end <br>//schema-element(bu-core2d:BuildingPart)/bu-base:dateOfConstruction/bu-base:DateOfEvent/bu-base:end <br>//schema-element(bu-core2d:BuildingPart)/bu-base:dateOfDemolition/bu-base:DateOfEvent/bu-base:end <br> //schema-element(bu-core2d:BuildingPart)/bu-base:dateOfRenovation/bu-base:DateOfEvent/bu-base:end <br>//schema-element(bu-core3d:Building)/bu-base:dateOfConstruction/bu-base:DateOfEvent/bu-base:end <br>//schema-element(bu-core3d:Building)/bu-base:dateOfDemolition/bu-base:DateOfEvent/bu-base:end <br>//schema-element(bu-core3d:Building)/bu-base:dateOfRenovation/bu-base:DateOfEvent/bu-base:end //schema-element(bu-core3d:BuildingPart)/bu-base:dateOfConstruction/bu-base:DateOfEvent/bu-base:end <br>//schema-element(bu-core3d:BuildingPart)/bu-base:dateOfDemolition/bu-base:DateOfEvent/bu-base:end <br>//schema-element(bu-core3d:BuildingPart)/bu-base:dateOfRenovation/bu-base:DateOfEvent/bu-base:end | 0..1 | Yes
anyPoint <a name="anyPoint"></a> | //schema-element(bu-core2d:Building)/bu-base:dateOfConstruction/bu-base:DateOfEvent/bu-base:anyPoint <br>//schema-element(bu-core2d:Building)/bu-base:dateOfDemolition/bu-base:DateOfEvent/bu-base:anyPoint <br> //schema-element(bu-core2d:Building)/bu-base:dateOfRenovation/bu-base:DateOfEvent/bu-base:anyPoint <br>//schema-element(bu-core2d:BuildingPart)/bu-base:dateOfConstruction/bu-base:DateOfEvent/bu-base:anyPoint <br>//schema-element(bu-core2d:BuildingPart)/bu-base:dateOfDemolition/bu-base:DateOfEvent/bu-base:anyPoint <br> //schema-element(bu-core2d:BuildingPart)/bu-base:dateOfRenovation/bu-base:DateOfEvent/bu-base:anyPoint <br>//schema-element(bu-core3d:Building)/bu-base:dateOfConstruction/bu-base:DateOfEvent/bu-base:anyPoint <br>//schema-element(bu-core3d:Building)/bu-base:dateOfDemolition/bu-base:DateOfEvent/bu-base:anyPoint <br>//schema-element(bu-core3d:Building)/bu-base:dateOfRenovation/bu-base:DateOfEvent/bu-base:anyPoint //schema-element(bu-core3d:BuildingPart)/bu-base:dateOfConstruction/bu-base:DateOfEvent/bu-base:anyPoint <br>//schema-element(bu-core3d:BuildingPart)/bu-base:dateOfDemolition/bu-base:DateOfEvent/bu-base:anyPoint <br>//schema-element(bu-core3d:BuildingPart)/bu-base:dateOfRenovation/bu-base:DateOfEvent/bu-base:anyPoint | 0..1 | Yes
value <a name="value"></a> | //schema-element(bu-core2d:Building)/bu-base:heightAboveGround/bu-base:HeightAboveGround/bu-base:value/@uom <br> //schema-element(bu-core2d:BuildingPart)/bu-base:heightAboveGround/bu-base:HeightAboveGround/bu-base:value/@uom <br>//schema-element(bu-core3d:Building)/bu-base:heightAboveGround/bu-base:HeightAboveGround/bu-base:value/@uom <br>//schema-element(bu-core3d:BuildingPart)/bu-base:heightAboveGround/bu-base:HeightAboveGround/bu-base:value/@uom  | 1 (The parent is optional) | No
geometry (TO BE COMPLETED) <a name="geometry"></a> | //schema-element(bu-core2d:Building)/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:geometry <br> //schema-element(bu-core3d:Building)/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:geometry <br> | 1  | No
" | //schema-element(bu-core2d:BuildingPart)/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:geometry <br>//schema-element(bu-core2d:Building)/bu-base:parts/bu-core2d:BuildingPart/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:geometry <br>//schema-element(bu-core3d:BuildingPart)/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:geometry <br>//schema-element(bu-core3d:Building)/bu-base:parts/bu-core2d:BuildingPart/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:geometry | 1 (The parent has multiplicity 1..*) | No
horizontalGeometryEstimatedAccuracy (TO BE COMPLETED) <a name="hGEA"></a> | //schema-element(bu-core2d:Building)/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:horizontalGeometryEstimatedAccuracy/@uom <br> //schema-element(bu-core3d:Building)/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:horizontalGeometryEstimatedAccuracy/@uom <br> | 1  | Yes
" | //schema-element(bu-core2d:BuildingPart)/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:horizontalGeometryEstimatedAccuracy/@uom <br>//schema-element(bu-core2d:Building)/bu-base:parts/bu-core2d:BuildingPart/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:horizontalGeometryEstimatedAccuracy/@uom <br>//schema-element(bu-core3d:BuildingPart)/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:horizontalGeometryEstimatedAccuracy/@uom <br>//schema-element(bu-core3d:Building)/bu-base:parts/bu-core2d:BuildingPart/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:horizontalGeometryEstimatedAccuracy/@uom | 1 (The parent has multiplicity 1..*) | Yes
verticalGeometryEstimatedAccuracy (TO BE COMPLETED) <a name="vGEA"></a> | //schema-element(bu-core2d:Building)/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:horizontalGeometryEstimatedAccuracy/@uom <br> //schema-element(bu-core3d:Building)/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:horizontalGeometryEstimatedAccuracy/@uom <br> | 0..1  | Yes
" | //schema-element(bu-core2d:BuildingPart)/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:horizontalGeometryEstimatedAccuracy/@uom <br>//schema-element(bu-core2d:Building)/bu-base:parts/bu-core2d:BuildingPart/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:horizontalGeometryEstimatedAccuracy/@uom <br>//schema-element(bu-core3d:BuildingPart)/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:horizontalGeometryEstimatedAccuracy/@uom <br>//schema-element(bu-core3d:Building)/bu-base:parts/bu-core2d:BuildingPart/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:horizontalGeometryEstimatedAccuracy/@uom | 0..1 | Yes
referenceGeometry (TO BE COMPLETED) <a name="referenceGeometry"></a> | //schema-element(bu-core2d:Building)/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:referenceGeometry <br> //schema-element(bu-core3d:Building)/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:referenceGeometry <br> | 1  | No
" | //schema-element(bu-core2d:BuildingPart)/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:referenceGeometry <br>//schema-element(bu-core2d:Building)/bu-base:parts/bu-core2d:BuildingPart/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:referenceGeometry <br>//schema-element(bu-core3d:BuildingPart)/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:referenceGeometry <br>//schema-element(bu-core3d:Building)/bu-base:parts/bu-core2d:BuildingPart/bu-core2d:geometry2D/bu-base:BuildingGeometry2D/bu-base:referenceGeometry | 1 (The parent has multiplicity 1..*) | No